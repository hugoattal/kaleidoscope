var ne=Object.defineProperty;var ie=(s,e,t)=>e in s?ne(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var G=(s,e,t)=>(ie(s,typeof e!="symbol"?e+"":e,t),t);import{l as H,d as b,r as ce,c as m,e as v,f as u,w as k,g as C,u as i,m as ue,n as de,o as R,q as K,s as M,t as pe,i as S,k as n,F as P,v as te,x as F,y as B,z as Y,E as ee,A as $,B as z,C as fe,D as me,G as J,H as L,p as j,j as Q,I as he,J as _e,K as ye,L as ve,M as ke,N as X}from"./index-DQNOGd6n.js";import{_ as T,s as Z}from"./_plugin-vue_export-helper-DRdWDLXJ.js";import{g as ae,a as ge,b as se}from"./cache-BFigyiXA.js";var N=(s=>(s.ANALYZER="analyzer",s.MIXER="mixer",s))(N||{});const A=H({current:"analyzer"}),Pe={class:"menu-wrapper"},be=b({__name:"KMenu",setup(s){const e=[{id:N.ANALYZER,icon:"monitoring",label:"Analyzer"},{id:N.MIXER,icon:"blender",label:"Mixer"}];return(t,r)=>{const a=ce("RouterLink");return m(),v("div",Pe,[u(a,{class:"title",to:"/"},{default:k(()=>[C(" Kaleidoscope ")]),_:1}),u(i(ue),{modelValue:i(A).current,"onUpdate:modelValue":r[0]||(r[0]=l=>i(A).current=l),options:e},null,8,["modelValue"])])}}}),we=T(be,[["__scopeId","data-v-1c379e9c"]]),o=H({playlists:[],selectedPlaylist:"",selectedPlaylists:[],tracks:[]}),V=H({moveSource:""});function O(){let s=0;for(const e of o.tracks)s+=e.duration_ms,e.total_duration=s}const I=de("ks-local",{deployedPlaylists:!1}),$e={class:"filter"},Me=b({__name:"KPlaylists",setup(s){R(async()=>{o.playlists=await ae()});function e(a){o.selectedPlaylist=a}const t=K(""),r=M(()=>o.playlists.filter(a=>a.name.toLowerCase().includes(t.value.toLowerCase())));return pe(()=>{o.selectedPlaylist=""}),(a,l)=>(m(),S(i(z),{class:"playlists-wrapper",depth:-2},{default:k(()=>[n("div",$e,[u(i(P),{icon:i(I).deployedPlaylists?"expand_more":"chevron_right",squared:"",onClick:l[0]||(l[0]=c=>i(I).deployedPlaylists=!i(I).deployedPlaylists)},null,8,["icon"]),u(i(te),{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=c=>t.value=c),class:"text-input",icon:"search",placeholder:"Filter playlists"},null,8,["modelValue"])]),n("div",{class:F(["playlists",{expanded:i(I).deployedPlaylists}])},[(m(!0),v(B,null,Y(r.value,c=>(m(),v("div",{key:c.id,class:"playlist"},[u(i(P),{icon:i(o).selectedPlaylist===c.id?"radio_button_checked":"radio_button_unchecked",type:i(o).selectedPlaylist===c.id?i(ee).Primary:i(ee).Default,onClick:w=>e(c.id)},{default:k(()=>[C($(c.name),1)]),_:2},1032,["icon","type","onClick"])]))),128))],2)]),_:1}))}}),Se=T(Me,[["__scopeId","data-v-f11049b4"]]),Te={class:"percentage-display"},xe={class:"value"},Ce=b({__name:"KPercentageDisplay",props:{colorMax:{default:"#0000bb"},colorMin:{default:"#770000"},max:{default:1},min:{default:0},value:{}},setup(s){const e=s,t=M(()=>`${(e.value-e.min)/(e.max-e.min)*100}%`),r=M(()=>e.max===1?`${Math.round(e.value*100)}%`:Math.round(e.value)),a=M(()=>{const c=(e.value-e.min)/(e.max-e.min);return Math.min(1,Math.max(0,c))}),l=M(()=>`color-mix(in lch, ${e.colorMax} ${a.value*100}%, ${e.colorMin})`);return(c,w)=>(m(),v("div",Te,[n("div",{class:"percentage",style:fe({width:t.value,backgroundColor:l.value})},null,4),n("div",xe,$(r.value),1)]))}}),E=T(Ce,[["__scopeId","data-v-f337ce27"]]),U=s=>(j("data-v-43ab0a2a"),s=s(),Q(),s),Ie=["draggable"],De={class:"index"},Ve={class:"time"},Ke={class:"cover"},Ee={class:"cover-wrapper"},Le=["src"],Be=["title"],Fe=["title"],ze=U(()=>n("div",{class:"insert-line"},null,-1)),Ne=[ze],Ae=U(()=>n("div",{class:"insert-line"},null,-1)),Re=[Ae],Ye={key:1},Oe=U(()=>n("td",{colspan:"4"},null,-1)),Ue={class:"big"},qe=U(()=>n("td",{colspan:7}," Loading... ",-1)),Ge=b({__name:"KTrack",props:{index:{},track:{}},setup(s){const e=s,t=M(()=>e.track.album&&e.track.artists&&e.track.features);function r(p){return new Date(p).getFullYear()}const a=K(!1);function l(){a.value=!0}function c(){V.moveSource=e.track.id}function w(){a.value=!1,V.moveSource=""}const h=K("");function d(p){h.value=p}function y(p){h.value===p&&(h.value="")}function _(p){if(V.moveSource!==e.track.id){const f=o.tracks.findIndex(q=>q.id===V.moveSource),x=o.tracks[f];o.tracks.splice(f,1);const D=o.tracks.findIndex(q=>q.id===e.track.id);o.tracks.splice(D+(p==="before"?0:1),0,x),O()}h.value="",a.value=!1,V.moveSource=""}function g(p){const f=Math.floor(p/36e5),x=Math.floor(p%36e5/6e4);return`${f}:${x.toString().padStart(2,"0")}`}return(p,f)=>{var x;return t.value?(m(),v("tr",{key:0,class:F(["track",{dragging:a.value}]),draggable:a.value,onDragend:w,onDragstart:c},[n("td",{class:"drag",onMousedown:J(l,["stop"])},[u(i(me),{icon:"drag_indicator"})],32),n("td",De,$(p.index+1),1),n("td",Ve,$(g(p.track.total_duration)),1),n("td",Ke,[n("div",Ee,[n("img",{alt:"Album cover",src:(x=p.track.album.images[0])==null?void 0:x.url},null,8,Le)])]),n("td",null,[n("div",{class:"big",title:p.track.name},$(p.track.name),9,Be)]),n("td",null,[n("div",{class:"big",title:p.track.artists[0].name},$(p.track.artists[0].name),9,Fe)]),n("td",null,[u(E,{max:2025,min:1980,value:r(p.track.album.release_date)},null,8,["value"])]),n("td",null,[u(E,{value:p.track.popularity/100},null,8,["value"])]),n("td",null,[u(E,{max:160,min:80,value:p.track.features.tempo},null,8,["value"])]),n("td",null,[u(E,{value:p.track.features.danceability},null,8,["value"])]),n("td",null,[u(E,{value:p.track.features.energy},null,8,["value"])]),n("td",null,[u(E,{value:p.track.features.valence},null,8,["value"])]),i(V).moveSource?(m(),v("div",{key:0,class:F(["drop-zone before",{hover:h.value==="before"}]),onDragenter:f[0]||(f[0]=D=>d("before")),onDragleave:f[1]||(f[1]=D=>y("before")),onDragover:f[2]||(f[2]=J(()=>{},["prevent"])),onDrop:f[3]||(f[3]=D=>_("before"))},Ne,34)):L("",!0),i(V).moveSource?(m(),v("div",{key:1,class:F(["drop-zone after",{hover:h.value==="after"}]),onDragenter:f[4]||(f[4]=D=>d("after")),onDragleave:f[5]||(f[5]=D=>y("after")),onDragover:f[6]||(f[6]=J(()=>{},["prevent"])),onDrop:f[7]||(f[7]=D=>_("after"))},Re,34)):L("",!0)],42,Ie)):(m(),v("tr",Ye,[Oe,n("td",null,[n("div",Ue,$(p.track.name),1)]),qe]))}}}),Je=T(Ge,[["__scopeId","data-v-43ab0a2a"]]);class Xe{constructor(e){G(this,"tracks",[]);G(this,"thresholds",{energy:0,popular:0,retro:0,speed:0});this.tracks=[...e]}generateThresholds(){this.tracks.sort((e,t)=>e.popularity-t.popularity),this.thresholds.popular=this.tracks[Math.floor(this.tracks.length*.5)].popularity,this.tracks.sort((e,t)=>e.features.energy-t.features.energy),this.thresholds.energy=this.tracks[Math.floor(this.tracks.length*.5)].features.energy,this.tracks.sort((e,t)=>e.features.tempo-t.features.tempo),this.thresholds.speed=this.tracks[Math.floor(this.tracks.length*.5)].features.tempo,this.tracks.sort((e,t)=>e.album.release_date.localeCompare(t.album.release_date)),this.thresholds.retro=new Date(this.tracks[Math.floor(this.tracks.length*.5)].album.release_date).getFullYear()}removeTrack(e){this.tracks.splice(this.tracks.indexOf(e),1)}getTrack(e){let t=[...this.tracks];if(e.filter.retro){const r=t.filter(a=>new Date(a.album.release_date).getFullYear()*e.filter.retro<=this.thresholds.retro*e.filter.retro);t=r.length?r:t}if(e.filter.speed){const r=t.filter(a=>a.features.tempo*e.filter.speed>=this.thresholds.speed*e.filter.speed);t=r.length?r:t}if(e.filter.popular){const r=t.filter(a=>a.popularity*e.filter.popular>=this.thresholds.popular*e.filter.popular);t=r.length?r:t}if(e.filter.energy){const r=t.filter(a=>a.features.energy*e.filter.energy>=this.thresholds.energy*e.filter.energy);t=r.length?r:t}if(e.limit.retro){t.sort((a,l)=>(new Date(a.album.release_date).getFullYear()-new Date(l.album.release_date).getFullYear())*e.limit.retro);const r=Math.floor(t.length*Math.abs(e.limit.retro));t.length=r||1}if(e.limit.speed){t.sort((a,l)=>(l.features.tempo-a.features.tempo)*e.limit.speed);const r=Math.floor(t.length*Math.abs(e.limit.speed));t.length=r||1}if(e.limit.popular){t.sort((a,l)=>(l.popularity-a.popularity)*e.limit.popular);const r=Math.floor(t.length*Math.abs(e.limit.popular));t.length=r||1}if(e.limit.energy){t.sort((a,l)=>(l.features.energy-a.features.energy)*e.limit.energy);const r=Math.floor(t.length*Math.abs(e.limit.energy));t.length=r||1}return t[Math.floor(t.length*Math.random())]}getSafeTrack(e){const t=e??this.tracks[Math.floor(this.tracks.length*Math.random())];return this.removeTrack(t),t}}function Ze(){const s=[...o.tracks];for(o.tracks=[];s.length;){const e=Math.floor(Math.random()*s.length);o.tracks.push(s.splice(e,1)[0])}O()}function He(){const s=new Xe(o.tracks);s.generateThresholds();const e=[],t=o.tracks.reduce((w,h)=>w+h.duration_ms,0);let r=0,a;a=s.getSafeTrack(s.getTrack({filter:{energy:1,popular:1,retro:-1},limit:{energy:.8}})),r+=a.duration_ms,e.push(a);let l=!1,c=!1;for(;r<t*.1;)c?c=!1:c=Math.random()>.25,a=s.getSafeTrack(s.getTrack({filter:{retro:c?1:-1,speed:l?-1:1},limit:{energy:.75,popular:.5,speed:.5}})),e.push(a),r+=a.duration_ms,l=!l;for(s.generateThresholds();r<t*.5;)c?c=!1:c=Math.random()>.25,a=s.getSafeTrack(s.getTrack({filter:{retro:c?1:-1,speed:l?-1:1},limit:{energy:.75,popular:.75,retro:Math.random()>.5?.25:0,speed:Math.random()>.5?.5:0}})),e.push(a),r+=a.duration_ms,l=!l;for(s.generateThresholds();r<t*.8;)c?c=!1:c=Math.random()>.25,a=s.getSafeTrack(s.getTrack({filter:{retro:c?1:0,speed:l?-1:1},limit:{energy:.75,popular:Math.random()>.5?.75:0,retro:Math.random()>.5?.25:0,speed:Math.random()>.5?.75:0}})),e.push(a),r+=a.duration_ms,l=!l;for(s.generateThresholds();s.tracks.length;)a=s.getSafeTrack(s.getTrack({filter:{speed:l?-1:1},limit:{}})),e.push(a),r+=a.duration_ms,l=!l;o.tracks=e,O()}async function le(s,e){for(let t=0;t<e.length;t+=100)await Z(`/playlists/${s}/tracks`,{body:JSON.stringify({tracks:e.slice(t,t+100).map(r=>({uri:`spotify:track:${r}`}))}),method:"DELETE"});for(let t=0;t<e.length;t+=100)await Z(`/playlists/${s}/tracks`,{body:JSON.stringify({uris:e.slice(t,t+100).map(r=>`spotify:track:${r}`)}),method:"POST"})}async function je(s,e){const{id:t}=await Z(`/users/${he.value}/playlists`,{body:JSON.stringify({name:s||"KS Export"}),method:"POST"});await le(t,e)}const Qe=s=>(j("data-v-8399fc64"),s=s(),Q(),s),We={class:"tracks-wrapper"},et=Qe(()=>n("tr",{class:"head"},[n("th",{colspan:"4"}),n("th",{class:"big"}," Name "),n("th",{class:"big"}," Artist "),n("th",{class:"value"}," Release "),n("th",{class:"value"}," Popularity "),n("th",{class:"value"}," Tempo "),n("th",{class:"value"}," Dance "),n("th",{class:"value"}," Energy "),n("th",{class:"value"}," Positive ")],-1)),tt={class:"buttons"},at=b({__name:"KTracks",setup(s){async function e(){const r=o.tracks.map(a=>a.id);await le(o.selectedPlaylist,r),alert("Playlist saved!")}async function t(){if(o.tracks.length===0){alert("No tracks to export!");return}let r=prompt("Enter playlist name");if(r===null)return;r||(r="KS Export");const a=o.tracks.map(l=>l.id);await je(r,a),alert("Playlist exported!")}return(r,a)=>(m(),v("div",We,[n("table",null,[et,(m(!0),v(B,null,Y(i(o).tracks,(l,c)=>(m(),S(Je,{key:l.id,index:c,track:l},null,8,["index","track"]))),128))]),n("div",tt,[i(o).selectedPlaylist?(m(),S(i(P),{key:0,icon:"save",onClick:e},{default:k(()=>[C(" Save playlist ")]),_:1})):L("",!0),u(i(P),{icon:"publish",onClick:t},{default:k(()=>[C(" Export playlist ")]),_:1}),u(i(P),{icon:"shuffle",onClick:i(Ze)},{default:k(()=>[C(" Shuffle ")]),_:1},8,["onClick"]),u(i(P),{icon:"category",onClick:i(He)},{default:k(()=>[C(" Smart sort ")]),_:1},8,["onClick"])])]))}}),re=T(at,[["__scopeId","data-v-8399fc64"]]);async function oe(){await ge(o.tracks),O()}const st=b({__name:"KLayoutAnalyzer",setup(s){return R(async()=>{o.tracks=[]}),_e(()=>o.selectedPlaylist,async e=>{e&&(o.tracks=await se(e),await oe())},{flush:"sync"}),(e,t)=>(m(),v(B,null,[u(Se),u(re)],64))}}),lt={class:"filter"},rt=b({__name:"KPlaylistsMultiple",setup(s){R(async()=>{o.playlists=await ae()});function e(a){o.selectedPlaylists.push(a)}const t=K(""),r=M(()=>o.playlists.filter(a=>a.name.toLowerCase().includes(t.value.toLowerCase())));return(a,l)=>(m(),S(i(z),{class:"playlists-wrapper",depth:-2},{default:k(()=>[n("div",lt,[u(i(P),{icon:i(I).deployedPlaylists?"expand_more":"chevron_right",squared:"",onClick:l[0]||(l[0]=c=>i(I).deployedPlaylists=!i(I).deployedPlaylists)},null,8,["icon"]),u(i(te),{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=c=>t.value=c),class:"text-input",icon:"search",placeholder:"Filter playlists"},null,8,["modelValue"])]),n("div",{class:F(["playlists",{expanded:i(I).deployedPlaylists}])},[(m(!0),v(B,null,Y(r.value,c=>(m(),v("div",{key:c.id,class:"playlist"},[u(i(P),{icon:"add",onClick:w=>e(c.id)},{default:k(()=>[C($(c.name),1)]),_:2},1032,["onClick"])]))),128))],2)]),_:1}))}}),ot=T(rt,[["__scopeId","data-v-63198692"]]),W=s=>(j("data-v-97571f71"),s=s(),Q(),s),nt={class:"options"},it={class:"option"},ct=W(()=>n("div",{class:"name"}," Mix mode ",-1)),ut={class:"form"},dt={class:"option"},pt=W(()=>n("div",{class:"name"}," Target duration (0 to disable) ",-1)),ft={class:"form"},mt={class:"option"},ht=W(()=>n("div",{class:"name"}," Remove duplicates ",-1)),_t={class:"form"},yt=b({__name:"KMixer",setup(s){const e=[{id:"BackToBack",label:"Back to back"},{id:"Interleaved",label:"Interleaved"},{id:"Progress",label:"Progress"}],t=K("BackToBack"),r=K(!0),a=K(0),l=M(()=>{const h=Math.floor(a.value/60),d=a.value%60;return`${h}h ${d}m`});async function c(){if(o.selectedPlaylists.length<1){alert("Select at least one playlist to merge");return}o.tracks=[];const h=[];for(const d of o.selectedPlaylists)h.push(await se(d));switch(t.value){case"BackToBack":if(o.tracks=h.flat(),r.value){const d=new Set;o.tracks=o.tracks.filter(y=>d.has(y.id)?!1:(d.add(y.id),!0))}break;case"Interleaved":{const d=Math.max(...h.map(_=>_.length)),y=new Set;for(let _=0;_<d;_++)for(const g of h){for(;r.value&&g[_]&&y.has(g[_].id);)g.splice(_,1);g[_]&&(o.tracks.push(g[_]),y.add(g[_].id))}}break;case"Progress":await w(h)}if(a.value>0)for(;o.tracks.reduce((d,y)=>d+y.duration_ms,0)>a.value*60*1e3;)o.tracks.splice(Math.floor(Math.random()*o.tracks.length),1);await oe()}async function w(h){const d=[],y=new Set;for(const _ of h){const g=_.reduce((f,x)=>f+x.duration_ms,0);let p=0;for(const f of _)d.push({progress:p/g,track:f}),p+=f.duration_ms}for(const _ of d){if(r.value&&y.has(_.track.id)){d.splice(d.indexOf(_),1);continue}y.add(_.track.id)}d.sort((_,g)=>_.progress-g.progress),o.tracks=d.map(_=>_.track)}return(h,d)=>(m(),S(i(z),{class:"mixer-wrapper",depth:-2},{default:k(()=>[n("div",nt,[n("div",it,[ct,n("div",ut,[u(i(ye),{modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=y=>t.value=y),class:"select",options:e},null,8,["modelValue"])])]),n("div",dt,[pt,n("div",ft,[u(i(ve),{modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=y=>a.value=y),clamp:"",class:"time",fixed:0,max:300,min:0,step:5,suffix:"min"},null,8,["modelValue"]),n("span",null,"("+$(l.value)+")",1)])]),n("div",mt,[ht,n("div",_t,[u(i(ke),{modelValue:r.value,"onUpdate:modelValue":d[2]||(d[2]=y=>r.value=y)},null,8,["modelValue"])])])]),u(i(P),{icon:"manufacturing",onClick:c},{default:k(()=>[C(" Generate ")]),_:1})]),_:1}))}}),vt=T(yt,[["__scopeId","data-v-97571f71"]]),kt={key:0,class:"playlist"},gt={class:"name"},Pt={class:"actions"},bt=b({__name:"KPlaylistsViewer",setup(s){const e=M(()=>o.playlists.reduce((l,c)=>(l[c.id]=c,l),{}));function t(l){if(l===0)return;const c=o.selectedPlaylists[l];o.selectedPlaylists[l]=o.selectedPlaylists[l-1],o.selectedPlaylists[l-1]=c}function r(l){if(l===o.selectedPlaylists.length-1)return;const c=o.selectedPlaylists[l];o.selectedPlaylists[l]=o.selectedPlaylists[l+1],o.selectedPlaylists[l+1]=c}function a(l){o.selectedPlaylists.splice(l,1)}return(l,c)=>(m(),S(i(z),{class:"playlists-viewer",depth:-2},{default:k(()=>[i(o).selectedPlaylists.length===0?(m(),v("div",kt," No playlist selected ")):L("",!0),(m(!0),v(B,null,Y(i(o).selectedPlaylists,(w,h)=>(m(),S(i(z),{key:h,class:"playlist"},{default:k(()=>[n("div",gt,$(e.value[w].name),1),n("div",Pt,[u(i(P),{icon:"arrow_back",size:i(X).Small,squared:"",onClick:d=>t(h)},null,8,["size","onClick"]),u(i(P),{icon:"arrow_forward",size:i(X).Small,squared:"",onClick:d=>r(h)},null,8,["size","onClick"]),u(i(P),{icon:"delete",size:i(X).Small,squared:"",onClick:d=>a(h)},null,8,["size","onClick"])])]),_:2},1024))),128))]),_:1}))}}),wt=T(bt,[["__scopeId","data-v-50746a49"]]),$t=b({__name:"KLayoutMixer",setup(s){return R(async()=>{o.tracks=[]}),(e,t)=>(m(),v(B,null,[u(ot),u(wt),u(vt),u(re)],64))}}),Mt={class:"layout"},St=b({__name:"KBuilderLayout",setup(s){return(e,t)=>(m(),v("div",Mt,[u(we),i(A).current===i(N).ANALYZER?(m(),S(st,{key:0})):L("",!0),i(A).current===i(N).MIXER?(m(),S($t,{key:1})):L("",!0)]))}}),Dt=T(St,[["__scopeId","data-v-7e5f33db"]]);export{Dt as default};
