import{O as U,d as M,P as V,u as v,q as g,Q as ne,s as m,o as G,t as oe,c as h,e as y,k as o,J as re,R as E,S as le,A as B,g as x,p as Q,j as W,y as L,z as j,x as J,C as ce,i as N,w as X,f as _,D as T,H as R,T as ue,U as z,m as O,F as ie}from"./index-DQNOGd6n.js";import{_ as S,s as Y}from"./_plugin-vue_export-helper-DRdWDLXJ.js";import{a as H}from"./cache-BFigyiXA.js";function de(e,t={}){let n=!0;t.fps??(t.fps=60);function u(){n=!1}let r=0,c=0;async function a(s){r||(r=s);const l=s-r;r=s,n&&(c+=l,c>1e3/t.fps&&(await e(c),c=0),requestAnimationFrame(a))}return requestAnimationFrame(a),u}const P=U("kds-particle-speed","1"),C=U("kds-background-color","#130505"),pe=["height","width"],_e=1/2e4,ve=1e3,he=5,fe=M({__name:"KBackground",props:{speed:{default:1}},setup(e){V(i=>({"71ab8e2c":v(C)}));const t=e,n=g(),u=g(),r=ne(u);let c;const a=m(()=>Math.min(ve,Math.floor(r.width.value*r.height.value*_e)));G(()=>{c=de(s)}),oe(()=>{c()});function s(i){ae(),te(i),se()}const l=[];function k(){return-Math.log(1-Math.random()*.99)*20+20}function I(){return-Math.log(1-Math.random()*.99)*.1+.1}function ae(){for(;l.length<a.value;)l.push({opacity:I(),radius:k(),x:Math.random(),y:Math.random()*2-.5});for(;l.length>a.value;)l.pop()}function te(i){const w=he*t.speed*i*.06/r.height.value*P.value;for(const p of l)p.y-=w/p.radius,p.y<-.5&&(p.y=1.5,p.x=Math.random(),p.radius=k(),p.opacity=I())}function se(){var A;const i=(A=n.value)==null?void 0:A.getContext("2d");if(!i)return;const w=n.value.width,p=n.value.height;i.clearRect(0,0,w,p);for(const f of l){const $=i.createRadialGradient(f.x*w,f.y*p,0,f.x*w,f.y*p,f.radius);$.addColorStop(0,`rgba(242, 146, 0, ${f.opacity*.6})`),$.addColorStop(.8,`rgba(242, 146, 0, ${f.opacity*.8})`),$.addColorStop(.9,`rgba(242, 146, 0, ${f.opacity})`),$.addColorStop(1,"rgba(242, 146, 0, 0)"),i.fillStyle="#f2920044",i.fillStyle=$,i.beginPath(),i.arc(f.x*w,f.y*p,f.radius,0,Math.PI*2),i.fill()}}return(i,w)=>(h(),y("div",{ref_key:"wrapper",ref:u,class:"canvas-wrapper"},[o("canvas",{ref_key:"canvas",ref:n,height:v(r).height.value,width:v(r).width.value},null,8,pe)],512))}}),me=S(fe,[["__scopeId","data-v-111142d9"]]),ye=""+new URL("rockit-D1Fp-gcz.svg",import.meta.url).href,K=g([]),d=g(),b=g([]),F=g(0),Z=g(0);async function q(){var t,n,u;const e=await Y("/me/player/queue");e.currently_playing&&((!d.value||d.value.id!==e.currently_playing.id)&&(d.value?K.value.push(d.value):K.value.length||(K.value=[e.currently_playing]),e.currently_playing.id===((t=b.value[0])==null?void 0:t.id)&&((n=e.queue[0])==null?void 0:n.id)===((u=b.value[1])==null?void 0:u.id)?(d.value=b.value.shift(),setTimeout(async()=>{await H(e.queue),b.value=e.queue},3e3)):(d.value=e.currently_playing,b.value=e.queue),await H([d.value,...b.value])),await ge(),Z.value++)}async function ge(){const e=await Y("/me/player");F.value=e.progress_ms}const we=e=>(Q("data-v-1ba52c54"),e=e(),W(),e),be={class:"playbar"},ke=we(()=>o("div",{class:"cursor"},null,-1)),xe={class:"remaining"},Me=M({__name:"KPlaybar",setup(e){V(s=>({"355860e5":c.value}));const t=g(0),n=g(0);re(()=>[F.value,d.value,Z.value],()=>{t.value=F.value,n.value=Date.now()},{immediate:!0});const u=m(()=>{const s=E({interval:1e3});return d.value.duration_ms-(t.value+(s.value-n.value))}),r=m(()=>{const s=Math.max(u.value,0),l=Math.floor(s/6e4),k=Math.floor(s%6e4/1e3);return`${l}:${k.toString().padStart(2,"0")}`}),c=m(()=>{const s=E({interval:1e3});return`${(t.value+(s.value-n.value))/d.value.duration_ms*100}%`});le(()=>u.value<=0,async()=>{const s=d.value.id;for(let l=0;l<5;l++)if(await a(1e3),await q(),d.value.id!==s)return});async function a(s=1e3){return new Promise(l=>setTimeout(l,s))}return(s,l)=>(h(),y("div",be,[ke,o("div",xe,[o("span",null,B(r.value),1),x(" restant ")])]))}}),Se=S(Me,[["__scopeId","data-v-1ba52c54"]]),$e={class:"feature-display"},Be=M({__name:"KFeatureDisplay",props:{colorMax:{},colorMin:{},max:{default:1},min:{default:0},steps:{default:5},value:{}},setup(e){V(s=>({"7d80deb9":c.value}));const t=e,n=m(()=>Math.min(Math.max((t.value-t.min)/(t.max-t.min),1e-4),.9999)),u=m(()=>Array.from({length:t.steps},(s,l)=>({display:l<t.steps*n.value?1:0}))),r=["#5555ff","#419bcc","#1cb374","#4dc116","#fffe00"],c=m(()=>{const s=Math.floor(t.steps*n.value);return r[s]}),a=m(()=>n.value>.8);return(s,l)=>(h(),y("div",$e,[(h(!0),y(L,null,j(u.value,(k,I)=>(h(),y("div",{key:I,class:J(["value",{shiny:a.value}]),style:ce({opacity:k.display})},null,6))),128))]))}}),D=S(Be,[["__scopeId","data-v-518a9ecf"]]),ee=e=>(Q("data-v-0c902c3d"),e=e(),W(),e),Ie={class:"cover"},Pe=["src"],Ce={class:"content"},Ke={class:"title"},Te={class:"name"},De={class:"artist"},Fe={key:0,class:"features"},Ve={class:"feature-wrapper"},Le={class:"label"},qe={class:"feature-wrapper"},Ae={class:"label"},Ee=ee(()=>o("span",null,"Popularité",-1)),Ne={class:"feature-wrapper"},Re={class:"label"},ze=ee(()=>o("span",null,"Énergie",-1)),Oe={class:"description"},He=M({__name:"KTracklist",setup(e){const t=m(()=>K.value.at(-1)),n=m(()=>b.value.slice(0,3)),u=m(()=>{const r=[];t.value&&r.push({type:"last",data:t.value,description:"Dernière"}),d.value&&r.push({type:"current",data:d.value,description:"En cours"});for(const[c,a]of n.value.entries())r.push({type:"next",data:a,description:`Prochaine ${c+1}`});return r});return(r,c)=>(h(),N(ue,{class:"tracklist",name:"list",tag:"div"},{default:X(()=>[(h(!0),y(L,null,j(u.value,a=>{var s;return h(),y("div",{key:a.data.id,class:J(["track",a.type])},[o("div",Ie,[o("img",{alt:"Album cover",src:(s=a.data.album.images[0])==null?void 0:s.url},null,8,Pe)]),o("div",Ce,[o("div",Ke,[o("span",Te,B(a.data.name),1),x(" ("),o("span",De,B(a.data.artists[0].name),1),x(") ")]),a.data.features?(h(),y("div",Fe,[o("div",Ve,[o("div",Le,[_(v(T),{class:"icon",icon:"speed"}),o("span",null,[x("Tempo ("),o("strong",null,B(Math.round(a.data.features.tempo)),1),x(" BPM)")])]),_(D,{class:"feature",max:160,min:80,value:a.data.features.tempo},null,8,["value"])]),o("div",qe,[o("div",Ae,[_(v(T),{class:"icon",icon:"trending_up"}),Ee]),_(D,{class:"feature",value:a.data.popularity/100},null,8,["value"])]),o("div",Ne,[o("div",Re,[_(v(T),{class:"icon",icon:"bolt"}),ze]),_(D,{class:"feature",value:a.data.features.energy},null,8,["value"])])])):R("",!0),a.type==="current"?(h(),N(Se,{key:1})):R("",!0)]),o("div",Oe,B(a.description),1)],2)}),128))]),_:1}))}}),Ue=S(He,[["__scopeId","data-v-0c902c3d"]]),Ge={class:"menu"},Qe=M({__name:"KPlayerMenu",setup(e){async function t(){await q()}const n=[{id:"0",icon:"stop",label:"Stop"},{id:"1",icon:"play_arrow",label:"Normal"},{id:"2",icon:"fast_forward",label:"Fast"}],u=[{id:"#1c0b0b",icon:"light_mode",label:"Normal"},{id:"#130505",icon:"cloud",label:"Dark"},{id:"#000000",icon:"dark_mode",label:"Darker"}];return(r,c)=>(h(),y("div",Ge,[_(v(O),{modelValue:v(C),"onUpdate:modelValue":c[0]||(c[0]=a=>z(C)?C.value=a:null),options:u},null,8,["modelValue"]),_(v(O),{modelValue:v(P),"onUpdate:modelValue":c[1]||(c[1]=a=>z(P)?P.value=a:null),options:n},null,8,["modelValue"]),_(v(ie),{icon:"refresh",onClick:t},{default:X(()=>[x(" Manual sync ")]),_:1})]))}}),We=S(Qe,[["__scopeId","data-v-57415196"]]),je={class:"content"},Je=["src"],Xe=M({__name:"KPlayerLayout",setup(e){return G(async()=>{await q()}),(t,n)=>(h(),y(L,null,[_(me,{class:"bokeh"}),_(We),o("div",je,[o("img",{alt:"RockIt Logo",class:"logo",src:v(ye)},null,8,Je),_(Ue)])],64))}}),aa=S(Xe,[["__scopeId","data-v-2dd750ed"]]);export{aa as default};
