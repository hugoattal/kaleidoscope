import{R as X,v as le,d as S,k as N,u,q as w,S as re,l as y,o as Y,D as ie,c as g,e as m,i as r,s as ue,T as z,x as ce,g as x,J as T,G as A,H as Z,K as de,z as ee,j as H,w as L,y as O,f,M as E,U as pe,B as G,V as U,F as Q,I as W}from"./index-B7W7EZy7.js";import{_ as $,s as ae}from"./_plugin-vue_export-helper-CoAGyLSr.js";import{a as j}from"./cache-DpU1_b95.js";function fe(o,a={}){let n=!0;a.fps??(a.fps=60);function d(){n=!1}let i=0,s=0;async function e(t){i||(i=t);const l=t-i;i=t,n&&(s+=l,s>1e3/a.fps&&(await o(s),s=0),requestAnimationFrame(e))}return requestAnimationFrame(e),d}const D=X("kds-particle-speed","1"),I=X("kds-background-color","#130505"),M=le({offline:!1}),ve=["height","width"],me=1/2e4,_e=1e3,ye=5,he=S({__name:"KBackground",props:{speed:{default:1}},setup(o){N(p=>({"71ab8e2c":u(I)}));const a=o,n=w(),d=w(),i=re(d);let s;const e=y(()=>Math.min(_e,Math.floor(i.width.value*i.height.value*me)));Y(()=>{s=fe(t)}),ie(()=>{s()});function t(p){se(),ne(p),oe()}const l=[];function b(){return-Math.log(1-Math.random()*.99)*20+20}function C(){return-Math.log(1-Math.random()*.99)*.1+.1}function se(){for(;l.length<e.value;)l.push({opacity:C(),radius:b(),x:Math.random(),y:Math.random()*2-.5});for(;l.length>e.value;)l.pop()}function ne(p){const k=ye*a.speed*p*.06/i.height.value*D.value;for(const v of l)v.y-=k/v.radius,v.y<-.5&&(v.y=1.5,v.x=Math.random(),v.radius=b(),v.opacity=C())}function oe(){var R;const p=(R=n.value)==null?void 0:R.getContext("2d");if(!p)return;const k=n.value.width,v=n.value.height;p.clearRect(0,0,k,v);for(const _ of l){const B=p.createRadialGradient(_.x*k,_.y*v,0,_.x*k,_.y*v,_.radius);B.addColorStop(0,`rgba(242, 146, 0, ${_.opacity*.6})`),B.addColorStop(.8,`rgba(242, 146, 0, ${_.opacity*.8})`),B.addColorStop(.9,`rgba(242, 146, 0, ${_.opacity})`),B.addColorStop(1,"rgba(242, 146, 0, 0)"),p.fillStyle="#f2920044",p.fillStyle=B,p.beginPath(),p.arc(_.x*k,_.y*v,_.radius,0,Math.PI*2),p.fill()}}return(p,k)=>(m(),g("div",{ref_key:"wrapper",ref:d,class:"canvas-wrapper"},[r("canvas",{ref_key:"canvas",ref:n,height:u(i).height.value,width:u(i).width.value},null,8,ve)],512))}}),ge=$(he,[["__scopeId","data-v-111142d9"]]),we=""+new URL("rockit-D1Fp-gcz.svg",import.meta.url).href,J=new Map;function be(){for(const o of h.value){const a=o.album.images[0].url;if(!J.has(a)){const n=new Image;n.src=o.album.images[0].url,J.set(a,n)}}}const K=w([]),c=w(),h=w([]),V=w(0),te=w(0),F=w(!1);async function P(){if(!F.value){F.value=!0;try{await ke()}finally{F.value=!1}}}async function ke(){var a,n,d;const o=await ae("/me/player/queue");o.currently_playing&&((!c.value||c.value.id!==o.currently_playing.id)&&(c.value?K.value.push(c.value):K.value.length||(K.value=[o.currently_playing]),o.currently_playing.id===((a=h.value[0])==null?void 0:a.id)&&((n=o.queue[0])==null?void 0:n.id)===((d=h.value[1])==null?void 0:d.id)?(c.value=h.value.shift(),setTimeout(async()=>{await j(o.queue),h.value=o.queue},3e3)):(c.value=o.currently_playing,h.value=o.queue),await j([c.value,...h.value])),await Me(),te.value++,M.offline&&be())}function xe(){h.value.length&&(c.value&&K.value.push(c.value),c.value=h.value.shift(),V.value=0)}async function Me(){const o=await ae("/me/player");V.value=o.progress_ms}const Se={class:"playbar"},$e={class:"remaining"},Be=S({__name:"KPlaybar",setup(o){N(t=>({"48db1a1e":s.value}));const a=w(0),n=w(0);ue(()=>[V.value,c.value,te.value],()=>{a.value=V.value,n.value=Date.now()},{immediate:!0});const d=y(()=>{const t=z({interval:1e3});return c.value.duration_ms-(a.value+(t.value-n.value))}),i=y(()=>{const t=Math.max(d.value,0),l=Math.floor(t/6e4),b=Math.floor(t%6e4/1e3);return`${l}:${b.toString().padStart(2,"0")}`}),s=y(()=>{const t=z({interval:1e3});return`${(a.value+(t.value-n.value))/c.value.duration_ms*100}%`});ce(()=>d.value<=0,async()=>{if(M.offline){xe(),await e(1e3),await P();return}const t=c.value.id;for(let l=0;l<5;l++){await e(1e3);try{if(await P(),c.value.id!==t)return}catch(b){console.warn("Failed to sync queue, retrying in 1s",b)}}});async function e(t=1e3){return new Promise(l=>setTimeout(l,t))}return(t,l)=>(m(),g("div",Se,[l[1]||(l[1]=r("div",{class:"cursor"},null,-1)),r("div",$e,[r("span",null,T(i.value),1),l[0]||(l[0]=x(" restant "))])]))}}),Te=$(Be,[["__scopeId","data-v-69a9d4a2"]]),Ke={class:"feature-display"},Pe=S({__name:"KFeatureDisplay",props:{colorMax:{},colorMin:{},max:{default:1},min:{default:0},steps:{default:5},value:{}},setup(o){N(t=>({"7d80deb9":s.value}));const a=o,n=y(()=>Math.min(Math.max((a.value-a.min)/(a.max-a.min),1e-4),.9999)),d=y(()=>Array.from({length:a.steps},(t,l)=>({display:l<a.steps*n.value?1:0}))),i=["#5555ff","#419bcc","#1cb374","#4dc116","#fffe00"],s=y(()=>{const t=Math.floor(a.steps*n.value);return i[t]}),e=y(()=>n.value>.8);return(t,l)=>(m(),g("div",Ke,[(m(!0),g(A,null,Z(d.value,(b,C)=>(m(),g("div",{key:C,class:ee(["value",{shiny:e.value}]),style:de({opacity:b.display})},null,6))),128))]))}}),q=$(Pe,[["__scopeId","data-v-518a9ecf"]]),Ce={class:"cover"},De=["src"],Ie={class:"content"},Fe={class:"title",translate:"no"},Ve={class:"name"},Ee={class:"artist"},qe={key:0,class:"features"},Le={class:"feature-wrapper"},Ne={class:"label"},Ae={class:"feature-wrapper"},Re={class:"label"},ze={class:"feature-wrapper"},He={class:"label"},Oe={class:"description"},Ge=S({__name:"KTracklist",setup(o){const a=y(()=>K.value.at(-1)),n=y(()=>h.value.slice(0,3)),d=y(()=>{const i=[];a.value&&i.push({type:"last",data:a.value,description:"Dernière"}),c.value&&i.push({type:"current",data:c.value,description:"En cours"});for(const[s,e]of n.value.entries())i.push({type:"next",data:e,description:`Prochaine ${s+1}`});return i});return(i,s)=>(m(),H(pe,{class:"tracklist",name:"list",tag:"div"},{default:L(()=>[(m(!0),g(A,null,Z(d.value,e=>{var t;return m(),g("div",{key:e.data.id,class:ee(["track",e.type])},[r("div",Ce,[r("img",{alt:"Album cover",src:(t=e.data.album.images[0])==null?void 0:t.url},null,8,De)]),r("div",Ie,[r("div",Fe,[r("span",Ve,T(e.data.name),1),s[0]||(s[0]=x(" (")),r("span",Ee,T(e.data.artists[0].name),1),s[1]||(s[1]=x(") "))]),e.data.features?(m(),g("div",qe,[r("div",Le,[r("div",Ne,[f(u(E),{class:"icon",icon:"speed"}),r("span",null,[s[2]||(s[2]=x("Tempo (")),r("strong",null,T(Math.round(e.data.features.tempo)),1),s[3]||(s[3]=x(" BPM)"))])]),f(q,{class:"feature",max:160,min:80,value:e.data.features.tempo},null,8,["value"])]),r("div",Ae,[r("div",Re,[f(u(E),{class:"icon",icon:"trending_up"}),s[4]||(s[4]=r("span",null,"Popularité",-1))]),f(q,{class:"feature",value:e.data.popularity/100},null,8,["value"])]),r("div",ze,[r("div",He,[f(u(E),{class:"icon",icon:"bolt"}),s[5]||(s[5]=r("span",null,"Énergie",-1))]),f(q,{class:"feature",value:e.data.features.energy},null,8,["value"])])])):O("",!0),e.type==="current"?(m(),H(Te,{key:1})):O("",!0)]),r("div",Oe,T(e.description),1)],2)}),128))]),_:1}))}}),Ue=$(Ge,[["__scopeId","data-v-9773f422"]]),Qe={class:"menu"},We=S({__name:"KPlayerMenu",setup(o){async function a(){await P()}async function n(){if(M.offline){M.offline=!1;return}M.offline=!0,await P()}const d=[{id:"0",icon:"stop",label:"Stop"},{id:"1",icon:"play_arrow",label:"Normal"},{id:"2",icon:"fast_forward",label:"Fast"}],i=[{id:"#1c0b0b",icon:"light_mode",label:"Normal"},{id:"#130505",icon:"cloud",label:"Dark"},{id:"#000000",icon:"dark_mode",label:"Darker"}];return(s,e)=>(m(),g("div",Qe,[f(u(G),{modelValue:u(I),"onUpdate:modelValue":e[0]||(e[0]=t=>U(I)?I.value=t:null),options:i},null,8,["modelValue"]),f(u(G),{modelValue:u(D),"onUpdate:modelValue":e[1]||(e[1]=t=>U(D)?D.value=t:null),options:d},null,8,["modelValue"]),f(u(Q),{icon:"refresh",onClick:a,disabled:u(F)},{default:L(()=>e[2]||(e[2]=[x(" Manual sync ")])),_:1},8,["disabled"]),f(u(Q),{icon:"refresh",onClick:n,type:u(M).offline?u(W).Primary:u(W).Default},{default:L(()=>e[3]||(e[3]=[x(" Offline sync ")])),_:1},8,["type"])]))}}),je=$(We,[["__scopeId","data-v-939e6ae7"]]),Je={class:"content"},Xe=["src"],Ye=S({__name:"KPlayerLayout",setup(o){return Y(async()=>{await P()}),(a,n)=>(m(),g(A,null,[f(ge,{class:"bokeh"}),f(je),r("div",Je,[r("img",{alt:"RockIt Logo",class:"logo",src:u(we)},null,8,Xe),f(Ue)])],64))}}),ta=$(Ye,[["__scopeId","data-v-8311cf01"]]);export{ta as default};
