import{R as Q,v as ne,d as S,k as L,u as l,q as _,S as se,l as g,o as N,E as oe,c as y,e as p,i as c,s as re,T as H,x as ie,g as B,K as $,f as h,U as le,w as I,H as z,I as W,z as J,y as A,j as X,F as q,J as P,B as O,V as j}from"./index-ioqeE1wk.js";import{_ as T,a as Y}from"./_plugin-vue_export-helper-CQIxWxgu.js";function ue(o,t={}){let s=!0;t.fps??=60;function r(){s=!1}let i=0,n=0;async function u(e){i||(i=e);const a=e-i;i=e,s&&(n+=a,n>1e3/t.fps&&(await o(n),n=0),requestAnimationFrame(u))}return requestAnimationFrame(u),r}const D=Q("kds-particle-speed","1"),V=Q("kds-background-color","#130505"),x=ne({offline:!1}),ce=["height","width"],de=1/2e4,fe=1e3,pe=5,ve=S({__name:"KBackground",props:{speed:{default:1}},setup(o){L(f=>({"71ab8e2c":l(V)}));const t=o,s=_(),r=_(),i=se(r);let n;const u=g(()=>Math.min(fe,Math.floor(i.width.value*i.height.value*de)));N(()=>{n=ue(e)}),oe(()=>{n()});function e(f){ee(),te(f),ae()}const a=[];function b(){return-Math.log(1-Math.random()*.99)*20+20}function U(){return-Math.log(1-Math.random()*.99)*.1+.1}function ee(){for(;a.length<u.value;)a.push({opacity:U(),radius:b(),x:Math.random(),y:Math.random()*2-.5});for(;a.length>u.value;)a.pop()}function te(f){const k=pe*t.speed*f*.06/i.height.value*D.value;for(const v of a)v.y-=k/v.radius,v.y<-.5&&(v.y=1.5,v.x=Math.random(),v.radius=b(),v.opacity=U())}function ae(){const f=s.value?.getContext("2d");if(!f)return;const k=s.value.width,v=s.value.height;f.clearRect(0,0,k,v);for(const m of a){const M=f.createRadialGradient(m.x*k,m.y*v,0,m.x*k,m.y*v,m.radius);M.addColorStop(0,`rgba(242, 146, 0, ${m.opacity*.6})`),M.addColorStop(.8,`rgba(242, 146, 0, ${m.opacity*.8})`),M.addColorStop(.9,`rgba(242, 146, 0, ${m.opacity})`),M.addColorStop(1,"rgba(242, 146, 0, 0)"),f.fillStyle="#f2920044",f.fillStyle=M,f.beginPath(),f.arc(m.x*k,m.y*v,m.radius,0,Math.PI*2),f.fill()}}return(f,k)=>(p(),y("div",{ref_key:"wrapper",ref:r,class:"canvas-wrapper"},[c("canvas",{ref_key:"canvas",ref:s,height:l(i).height.value,width:l(i).width.value},null,8,ce)],512))}}),_e=T(ve,[["__scopeId","data-v-111142d9"]]),me=""+new URL("rockit-D1Fp-gcz.svg",import.meta.url).href,G=new Map;function ye(){for(const o of w.value){const t=o.album.images[0].url;if(!G.has(t)){const s=new Image;s.src=o.album.images[0].url,G.set(t,s)}}}const K=_([]),d=_(),w=_([]),R=_(0),Z=_(0),F=_(!1),C=_(!0);async function E(){if(!F.value){F.value=!0;try{await he()}finally{F.value=!1}}}async function he(){const o=await Y("/me/player/queue");o.currently_playing&&((!d.value||d.value.id!==o.currently_playing.id)&&(d.value?K.value.push(d.value):K.value.length||(K.value=[o.currently_playing,o.currently_playing]),o.currently_playing.id===w.value[0]?.id&&o.queue[0]?.id===w.value[1]?.id?(d.value=w.value.shift(),setTimeout(async()=>{w.value=o.queue},3e3)):(d.value=o.currently_playing,w.value=o.queue)),await be(),Z.value++,x.offline&&ye())}function ge(){w.value.length&&(d.value&&K.value.push(d.value),d.value=w.value.shift(),R.value=0)}async function be(){const o=await Y("/me/player");R.value=o.progress_ms}const we={class:"playbar"},ke={class:"remaining"},xe=S({__name:"KPlaybar",setup(o){L(e=>({"04079d1f":n.value}));const t=_(0),s=_(0);re(()=>[R.value,d.value,Z.value],()=>{t.value=R.value,s.value=Date.now()},{immediate:!0});const r=g(()=>{const e=H({interval:1e3});return d.value.duration_ms-(t.value+(e.value-s.value))}),i=g(()=>{const e=Math.max(r.value,0),a=Math.floor(e/6e4),b=Math.floor(e%6e4/1e3);return`${a}:${b.toString().padStart(2,"0")}`}),n=g(()=>{const e=H({interval:1e3});return`${(t.value+(e.value-s.value))/d.value.duration_ms*100}%`});ie(()=>r.value<=0,async()=>{if(x.offline){ge(),await u(1e3),await E();return}const e=d.value.id;for(let a=0;a<5;a++){await u(1e3);try{if(await E(),d.value.id!==e)return}catch(b){console.warn("Failed to sync queue, retrying in 1s",b)}}});async function u(e=1e3){return new Promise(a=>setTimeout(a,e))}return(e,a)=>(p(),y("div",we,[a[1]||(a[1]=c("div",{class:"cursor"},null,-1)),c("div",ke,[c("span",null,$(i.value),1),a[0]||(a[0]=B(" restant ",-1))])]))}}),$e=T(xe,[["__scopeId","data-v-421dd383"]]),Se={class:"tracklist-wrapper"},Te={class:"cover"},Me=["src"],Pe={key:0,class:"position"},Be={class:"content"},Ke={class:"title",translate:"no"},Ce={class:"time"},Ee={class:"artist",translate:"no"},Ie=S({__name:"KTracklist",setup(o){const t=g(()=>K.value.toReversed().slice(0,2)),s=g(()=>w.value.slice(0,6)),r=g(()=>{const n=[],u=new Set;function e(a){return u.has(a)?e(`${a}x`):(u.add(a),a)}t.value[0]&&n.push({id:e(t.value[0].id),type:"last",data:t.value[0],position:-2}),t.value[1]&&n.push({id:e(t.value[1].id),type:"last",data:t.value[1],position:-1}),d.value&&n.push({id:e(d.value.id),type:"current",data:d.value,position:0});for(const[a,b]of s.value.entries())n.push({id:e(b.id),type:"next",data:b,position:a+1});return n});function i(n){const u=Math.floor(n/6e4),e=Math.floor(n%6e4/1e3);return`${u}:${e.toString().padStart(2,"0")}`}return(n,u)=>(p(),y("div",Se,[h(le,{class:"tracklist",name:"list",tag:"div"},{default:I(()=>[(p(!0),y(z,null,W(r.value,e=>(p(),y("div",{key:e.id,class:J(["track",e.type])},[c("div",Te,[c("img",{alt:"Album cover",src:e.data.album.images[0]?.url},null,8,Me),e.type!=="current"?(p(),y("div",Pe,$(e.position),1)):A("",!0)]),c("div",Be,[c("div",Ke,[c("span",Ce,"["+$(i(e.data.duration_ms))+"]",1),B(" "+$(e.data.name),1)]),c("div",Ee,$(e.data.artists[0].name),1),e.type==="current"?(p(),X($e,{key:0})):A("",!0)])],2))),128))]),_:1})]))}}),De=T(Ie,[["__scopeId","data-v-4d428092"]]),Ve={class:"menu"},Fe=S({__name:"KPlayerMenu",setup(o){async function t(){await E()}async function s(){if(x.offline){x.offline=!1;return}x.offline=!0,await E()}function r(){C.value=!C.value}const i=[{id:"0",icon:"stop",label:"Stop"},{id:"1",icon:"play_arrow",label:"Normal"},{id:"2",icon:"fast_forward",label:"Fast"}],n=[{id:"#1c0b0b",icon:"light_mode",label:"Normal"},{id:"#130505",icon:"cloud",label:"Dark"},{id:"#000000",icon:"dark_mode",label:"Darker"}];return(u,e)=>(p(),y("div",Ve,[h(l(q),{icon:"event",type:l(C)?l(P).Primary:l(x).offline?l(P).Primary:l(P).Default,onClick:r},{default:I(()=>e[2]||(e[2]=[B(" Toggle events ",-1)])),_:1,__:[2]},8,["type"]),h(l(O),{modelValue:l(V),"onUpdate:modelValue":e[0]||(e[0]=a=>j(V)?V.value=a:null),options:n},null,8,["modelValue"]),h(l(O),{modelValue:l(D),"onUpdate:modelValue":e[1]||(e[1]=a=>j(D)?D.value=a:null),options:i},null,8,["modelValue"]),h(l(q),{disabled:l(F),icon:"refresh",onClick:t},{default:I(()=>e[3]||(e[3]=[B(" Manual sync ",-1)])),_:1,__:[3]},8,["disabled"]),h(l(q),{icon:"refresh",type:l(x).offline?l(P).Primary:l(P).Default,onClick:s},{default:I(()=>e[4]||(e[4]=[B(" Offline sync ",-1)])),_:1,__:[4]},8,["type"])]))}}),Re=T(Fe,[["__scopeId","data-v-1e493a91"]]),qe={class:"event"},Ae={class:"content"},Le={class:"title"},Ne={class:"date"},ze=S({__name:"KEvent",props:{event:{}},setup(o){L(n=>({"4d26ce7a":r.value}));const t=o,s=g(()=>{const n=t.event.attributes.titlePrefix||t.event.attributes.eventType.data.attributes.defaultTitlePrefix||"",u=t.event.attributes.titleSuffix||t.event.attributes.eventType.data.attributes.defaultTitleSuffix||"";return`${n} ${u}`.trim()}),r=g(()=>`url(${t.event.attributes.banner?.data.attributes.url||t.event.attributes.eventType.data.attributes.defaultBanner.data.attributes.url})`),i=g(()=>{const n=new Date(t.event.attributes.startAt);return new Intl.DateTimeFormat("fr-FR",{day:"numeric",hour:"2-digit",minute:"2-digit",month:"long",weekday:"long",year:"numeric"}).format(n)});return(n,u)=>(p(),y("div",qe,[u[0]||(u[0]=c("div",{class:"banner"},[c("div",{class:"gradient"})],-1)),c("div",Ae,[c("div",Le,$(s.value),1),c("div",Ne,$(i.value),1)])]))}}),Ue=T(ze,[["__scopeId","data-v-1a0985bd"]]),He={key:0,class:"events"},Oe=S({__name:"KEvents",setup(o){const t=_([]);return N(async()=>{const s=new URL("https://strapi.rockit.dance/api");s.pathname="/api/events";const r=s.searchParams;r.set("sort","startAt"),r.set("pagination[pageSize]","5"),r.set("filters[endAt][$gt]",`${Date.now()}`),r.set("populate","banner"),r.set("populate","eventType.defaultBanner");const n=await(await fetch(s.toString(),{headers:{Authorization:"Bearer 1d0a0cd407c0d41d7aac1eea4019f44466e2372158b3a58f9e1f6b8f5d0f646051986b24642cdccb58bfecee9f5377a3c63100c4dc99b0beec85ad4a2cc89ca3bb2e68708471377fb073070ef5000fd7c981bdd6cf3b365abefb5ef503a23cbea09bcc47c2b39367751df1af415eae111904c78c7212a894fbd09c05e508973c","Content-Type":"application/json"}})).json();t.value=n.data}),(s,r)=>l(C)?(p(),y("div",He,[r[0]||(r[0]=c("div",{class:"title"}," Prochains événements ",-1)),(p(!0),y(z,null,W(t.value,i=>(p(),X(Ue,{key:i.id,event:i},null,8,["event"]))),128))])):A("",!0)}}),je=T(Oe,[["__scopeId","data-v-9adf51f5"]]),Ge=["src"],Qe=S({__name:"KPlayerLayout",setup(o){return N(async()=>{await E()}),(t,s)=>(p(),y(z,null,[h(_e,{class:"bokeh"}),h(je),h(Re),c("div",{class:J(["content",{"with-events":l(C)}])},[c("img",{alt:"RockIt Logo",class:"logo",src:l(me)},null,8,Ge),h(De)],2)],64))}}),Xe=T(Qe,[["__scopeId","data-v-7da917bd"]]);export{Xe as default};
