import{R as Q,v as oe,d as S,k as L,u as d,q as w,S as le,l as y,o as X,D as re,c as g,e as m,i as r,s as ie,T as R,x as ue,g as x,J as T,G as N,H as Y,K as ce,z as Z,j as z,w as E,y as H,f,M as V,U as de,B as O,V as G,F as U,I as W}from"./index-CiRLeafl.js";import{_ as $,s as ee}from"./_plugin-vue_export-helper-CU3IPYf_.js";import{a as j}from"./cache-Ca42LyKD.js";function pe(l,a={}){let n=!0;a.fps??(a.fps=60);function c(){n=!1}let i=0,s=0;async function e(t){i||(i=t);const o=t-i;i=t,n&&(s+=o,s>1e3/a.fps&&(await l(s),s=0),requestAnimationFrame(e))}return requestAnimationFrame(e),c}const D=Q("kds-particle-speed","1"),F=Q("kds-background-color","#130505"),M=oe({offline:!1}),fe=["height","width"],ve=1/2e4,me=1e3,_e=5,ye=S({__name:"KBackground",props:{speed:{default:1}},setup(l){L(p=>({"71ab8e2c":d(F)}));const a=l,n=w(),c=w(),i=le(c);let s;const e=y(()=>Math.min(me,Math.floor(i.width.value*i.height.value*ve)));X(()=>{s=pe(t)}),re(()=>{s()});function t(p){te(),se(p),ne()}const o=[];function b(){return-Math.log(1-Math.random()*.99)*20+20}function C(){return-Math.log(1-Math.random()*.99)*.1+.1}function te(){for(;o.length<e.value;)o.push({opacity:C(),radius:b(),x:Math.random(),y:Math.random()*2-.5});for(;o.length>e.value;)o.pop()}function se(p){const k=_e*a.speed*p*.06/i.height.value*D.value;for(const v of o)v.y-=k/v.radius,v.y<-.5&&(v.y=1.5,v.x=Math.random(),v.radius=b(),v.opacity=C())}function ne(){var A;const p=(A=n.value)==null?void 0:A.getContext("2d");if(!p)return;const k=n.value.width,v=n.value.height;p.clearRect(0,0,k,v);for(const _ of o){const B=p.createRadialGradient(_.x*k,_.y*v,0,_.x*k,_.y*v,_.radius);B.addColorStop(0,`rgba(242, 146, 0, ${_.opacity*.6})`),B.addColorStop(.8,`rgba(242, 146, 0, ${_.opacity*.8})`),B.addColorStop(.9,`rgba(242, 146, 0, ${_.opacity})`),B.addColorStop(1,"rgba(242, 146, 0, 0)"),p.fillStyle="#f2920044",p.fillStyle=B,p.beginPath(),p.arc(_.x*k,_.y*v,_.radius,0,Math.PI*2),p.fill()}}return(p,k)=>(m(),g("div",{ref_key:"wrapper",ref:c,class:"canvas-wrapper"},[r("canvas",{ref_key:"canvas",ref:n,height:d(i).height.value,width:d(i).width.value},null,8,fe)],512))}}),he=$(ye,[["__scopeId","data-v-111142d9"]]),ge=""+new URL("rockit-D1Fp-gcz.svg",import.meta.url).href,J=new Map;function we(){for(const l of h.value){const a=l.album.images[0].url;if(!J.has(a)){const n=new Image;n.src=l.album.images[0].url,J.set(a,n)}}}const K=w([]),u=w(),h=w([]),I=w(0),ae=w(0);async function P(){var a,n,c;const l=await ee("/me/player/queue");l.currently_playing&&((!u.value||u.value.id!==l.currently_playing.id)&&(u.value?K.value.push(u.value):K.value.length||(K.value=[l.currently_playing]),l.currently_playing.id===((a=h.value[0])==null?void 0:a.id)&&((n=l.queue[0])==null?void 0:n.id)===((c=h.value[1])==null?void 0:c.id)?(u.value=h.value.shift(),setTimeout(async()=>{await j(l.queue),h.value=l.queue},3e3)):(u.value=l.currently_playing,h.value=l.queue),await j([u.value,...h.value])),await ke(),ae.value++,M.offline&&we())}function be(){h.value.length&&(u.value&&K.value.push(u.value),u.value=h.value.shift(),I.value=0)}async function ke(){const l=await ee("/me/player");I.value=l.progress_ms}const xe={class:"playbar"},Me={class:"remaining"},Se=S({__name:"KPlaybar",setup(l){L(t=>({"2c457048":s.value}));const a=w(0),n=w(0);ie(()=>[I.value,u.value,ae.value],()=>{a.value=I.value,n.value=Date.now()},{immediate:!0});const c=y(()=>{const t=R({interval:1e3});return u.value.duration_ms-(a.value+(t.value-n.value))}),i=y(()=>{const t=Math.max(c.value,0),o=Math.floor(t/6e4),b=Math.floor(t%6e4/1e3);return`${o}:${b.toString().padStart(2,"0")}`}),s=y(()=>{const t=R({interval:1e3});return`${(a.value+(t.value-n.value))/u.value.duration_ms*100}%`});ue(()=>c.value<=0,async()=>{if(M.offline){be();try{await e(1e3),await P()}catch(o){console.warn("Failed to sync queue, relying on cache instead",o)}return}const t=u.value.id;for(let o=0;o<5;o++){await e(1e3);try{if(await P(),u.value.id!==t)return}catch(b){console.warn("Failed to sync queue, retrying in 1s",b)}}});async function e(t=1e3){return new Promise(o=>setTimeout(o,t))}return(t,o)=>(m(),g("div",xe,[o[1]||(o[1]=r("div",{class:"cursor"},null,-1)),r("div",Me,[r("span",null,T(i.value),1),o[0]||(o[0]=x(" restant "))])]))}}),$e=$(Se,[["__scopeId","data-v-da2aa5c5"]]),Be={class:"feature-display"},Te=S({__name:"KFeatureDisplay",props:{colorMax:{},colorMin:{},max:{default:1},min:{default:0},steps:{default:5},value:{}},setup(l){L(t=>({"7d80deb9":s.value}));const a=l,n=y(()=>Math.min(Math.max((a.value-a.min)/(a.max-a.min),1e-4),.9999)),c=y(()=>Array.from({length:a.steps},(t,o)=>({display:o<a.steps*n.value?1:0}))),i=["#5555ff","#419bcc","#1cb374","#4dc116","#fffe00"],s=y(()=>{const t=Math.floor(a.steps*n.value);return i[t]}),e=y(()=>n.value>.8);return(t,o)=>(m(),g("div",Be,[(m(!0),g(N,null,Y(c.value,(b,C)=>(m(),g("div",{key:C,class:Z(["value",{shiny:e.value}]),style:ce({opacity:b.display})},null,6))),128))]))}}),q=$(Te,[["__scopeId","data-v-518a9ecf"]]),Ke={class:"cover"},Pe=["src"],Ce={class:"content"},De={class:"title"},Fe={class:"name"},Ie={class:"artist"},Ve={key:0,class:"features"},qe={class:"feature-wrapper"},Ee={class:"label"},Le={class:"feature-wrapper"},Ne={class:"label"},Ae={class:"feature-wrapper"},Re={class:"label"},ze={class:"description"},He=S({__name:"KTracklist",setup(l){const a=y(()=>K.value.at(-1)),n=y(()=>h.value.slice(0,3)),c=y(()=>{const i=[];a.value&&i.push({type:"last",data:a.value,description:"Dernière"}),u.value&&i.push({type:"current",data:u.value,description:"En cours"});for(const[s,e]of n.value.entries())i.push({type:"next",data:e,description:`Prochaine ${s+1}`});return i});return(i,s)=>(m(),z(de,{class:"tracklist",name:"list",tag:"div"},{default:E(()=>[(m(!0),g(N,null,Y(c.value,e=>{var t;return m(),g("div",{key:e.data.id,class:Z(["track",e.type])},[r("div",Ke,[r("img",{alt:"Album cover",src:(t=e.data.album.images[0])==null?void 0:t.url},null,8,Pe)]),r("div",Ce,[r("div",De,[r("span",Fe,T(e.data.name),1),s[0]||(s[0]=x(" (")),r("span",Ie,T(e.data.artists[0].name),1),s[1]||(s[1]=x(") "))]),e.data.features?(m(),g("div",Ve,[r("div",qe,[r("div",Ee,[f(d(V),{class:"icon",icon:"speed"}),r("span",null,[s[2]||(s[2]=x("Tempo (")),r("strong",null,T(Math.round(e.data.features.tempo)),1),s[3]||(s[3]=x(" BPM)"))])]),f(q,{class:"feature",max:160,min:80,value:e.data.features.tempo},null,8,["value"])]),r("div",Le,[r("div",Ne,[f(d(V),{class:"icon",icon:"trending_up"}),s[4]||(s[4]=r("span",null,"Popularité",-1))]),f(q,{class:"feature",value:e.data.popularity/100},null,8,["value"])]),r("div",Ae,[r("div",Re,[f(d(V),{class:"icon",icon:"bolt"}),s[5]||(s[5]=r("span",null,"Énergie",-1))]),f(q,{class:"feature",value:e.data.features.energy},null,8,["value"])])])):H("",!0),e.type==="current"?(m(),z($e,{key:1})):H("",!0)]),r("div",ze,T(e.description),1)],2)}),128))]),_:1}))}}),Oe=$(He,[["__scopeId","data-v-0c902c3d"]]),Ge={class:"menu"},Ue=S({__name:"KPlayerMenu",setup(l){async function a(){await P()}async function n(){if(M.offline){M.offline=!1;return}M.offline=!0,await P()}const c=[{id:"0",icon:"stop",label:"Stop"},{id:"1",icon:"play_arrow",label:"Normal"},{id:"2",icon:"fast_forward",label:"Fast"}],i=[{id:"#1c0b0b",icon:"light_mode",label:"Normal"},{id:"#130505",icon:"cloud",label:"Dark"},{id:"#000000",icon:"dark_mode",label:"Darker"}];return(s,e)=>(m(),g("div",Ge,[f(d(O),{modelValue:d(F),"onUpdate:modelValue":e[0]||(e[0]=t=>G(F)?F.value=t:null),options:i},null,8,["modelValue"]),f(d(O),{modelValue:d(D),"onUpdate:modelValue":e[1]||(e[1]=t=>G(D)?D.value=t:null),options:c},null,8,["modelValue"]),f(d(U),{icon:"refresh",onClick:a},{default:E(()=>e[2]||(e[2]=[x(" Manual sync ")])),_:1}),f(d(U),{icon:"refresh",onClick:n,type:d(M).offline?d(W).Primary:d(W).Default},{default:E(()=>e[3]||(e[3]=[x(" Offline sync ")])),_:1},8,["type"])]))}}),We=$(Ue,[["__scopeId","data-v-b9fc0e99"]]),je={class:"content"},Je=["src"],Qe=S({__name:"KPlayerLayout",setup(l){return X(async()=>{await P()}),(a,n)=>(m(),g(N,null,[f(he,{class:"bokeh"}),f(We),r("div",je,[r("img",{alt:"RockIt Logo",class:"logo",src:d(ge)},null,8,Je),f(Oe)])],64))}}),ea=$(Qe,[["__scopeId","data-v-2dd750ed"]]);export{ea as default};
